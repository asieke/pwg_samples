<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>PaymentRequest Demo Store</title>
    <link rel='shortcut icon' href='/android.ico' type='image/x-icon'/ >

    <!-- Bootstrap -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>

  <div class="container">

    <h2><img src='https://upload.wikimedia.org/wikipedia/commons/thumb/5/53/Google_%22G%22_Logo.svg/480px-Google_%22G%22_Logo.svg.png' style='height: 36px; width: 36px'>&nbsp;Pay with Google</h2> 

    <p>Express checkout with Google Payment API</p>

    <div>
      <button id="buyButton" class='btn btn-primary' style='width: 100%'>Express Checkout</button><br><br>
      <pre id="result">
     
      </pre>
    </div>

  </div>

  </body>
</html>

<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

<script>

function onBuyClicked() {

  var supportedInstruments = [
    {
      supportedMethods: ['basic-card'],
      data: {
        supportedNetworks: ['amex', 'discover', 'mastercard', 'visa']
      }
    },
    {
      supportedMethods: ['https://google.com/pay'],
      data: {
       "merchantName":"testApp Payment Request",
       "merchantId":"02510116604241796260",
       "apiVersion":1,
       "paymentMethodTokenizationParameters":
        {
           "tokenizationType":"PAYMENT_GATEWAY",
           "parameters":
           {
               "stripe:publishableKey":"pk_live_u4W1tkj5FEHBipLTfqrBYJyp",
               "gateway":"stripe",
               "stripe:version":"5"
           }
        },
       "allowedPaymentMethods":["CARD","TOKENIZED_CARD"],
       "cardRequirements":
       {
           "allowedCardNetworks":["AMEX","DISCOVER","MASTERCARD","VISA"],
           "billingAddressRequired":true,
           "billingAddressFormat":"FULL"
       },
       "phoneNumberRequired":true,
       "emailRequired":false
      }
    }
  ];

  var details = {
    total: {label: 'Donation', amount: {currency: 'USD', value: '55.00'}},
    displayItems: [
      {
        label: 'Original donation amount',
        amount: {currency: 'USD', value: '65.00'}
      },
      {
        label: 'Friends and family discount',
        amount: {currency: 'USD', value: '-10.00'}
      },
      {
        label: 'Standard shipping',
        amount: {currency: 'USD', value: '0.00'}
      }
    ],
    shippingOptions: [
      {
        id: 'standard',
        label: 'Standard shipping',
        amount: {currency: 'USD', value: '0.00'},
        selected: true
      },
      {
        id: 'express',
        label: 'Express shipping',
        amount: {currency: 'USD', value: '12.00'}
      }
    ]
  };

  var options = {requestShipping: false};

  try {
    var request = new PaymentRequest(supportedInstruments, details, options); // eslint-disable-line no-undef

    request.addEventListener('shippingoptionchange', function(evt) {
      evt.updateWith(new Promise(function(resolve, reject) {
        updateDetails(details, request.shippingOption, resolve, reject);
      }));
    });

    request.show().then(function(instrumentResponse) {
      // Simulate server-side processing with a 2 second delay.
      window.setTimeout(function() {
        instrumentResponse.complete('success')
            .then(function() {
              document.getElementById('result').innerHTML =
                  'shippingOption: ' + request.shippingOption +
                  '<br>shippingAddress: ' +
                  JSON.stringify(
                      toDictionary(instrumentResponse.shippingAddress),
                      undefined, 2) +
                  '<br>methodName: ' + instrumentResponse.methodName +
                  '<br>details: ' +
                  JSON.stringify(instrumentResponse.details, undefined, 2);
            })
            .catch(function(err) {
              document.getElementById('result').innerHTML = (err.message);
            });
      }, 2000);
    })
    .catch(function(err) {
      document.getElementById('result').innerHTML = (err.message);
    });
  } catch (e) {
    document.getElementById('result').innerHTML = ('Developer mistake: \'' + e.message + '\'');
  }

}

var buyButton = document.getElementById('buyButton');
buyButton.addEventListener('click', onBuyClicked);

function updateDetails(details, shippingOption, resolve, reject) {
  var selectedShippingOption;
  var otherShippingOption;
  if (shippingOption === 'standard') {
    selectedShippingOption = details.shippingOptions[0];
    otherShippingOption = details.shippingOptions[1];
    details.total.amount.value = '55.00';
  } else if (shippingOption === 'express') {
    selectedShippingOption = details.shippingOptions[1];
    otherShippingOption = details.shippingOptions[0];
    details.total.amount.value = '67.00';
  } else {
    reject('Unknown shipping option \'' + shippingOption + '\'');
    return;
  }
  selectedShippingOption.selected = true;
  otherShippingOption.selected = false;
  details.displayItems.splice(2, 1, selectedShippingOption);
  resolve(details);
}

function toDictionary(addr) {
  var dict = {};
  if (addr) {
    dict.country = addr.country;
    dict.region = addr.region;
    dict.city = addr.city;
    dict.dependentLocality = addr.dependentLocality;
    dict.addressLine = addr.addressLine;
    dict.postalCode = addr.postalCode;
    dict.sortingCode = addr.sortingCode;
    dict.languageCode = addr.languageCode;
    dict.organization = addr.organization;
    dict.recipient = addr.recipient;
    dict.careOf = addr.careOf;
    dict.phone = addr.phone;
  }
  return dict;
}


</script>